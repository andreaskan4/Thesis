@page "/studentprof"
@inject AuthStateService AuthStateService
@inject NavigationManager Navigation
@inject IJSRuntime JSRuntime
@inject Data.AppDbContext Context
@using Microsoft.EntityFrameworkCore
@using Thesis.Models

<PageTitle>Thesis - Student Profile</PageTitle>

@if (!isAuthChecked)
{
    <div class="loading-container">
        <div class="spinner"></div>
        <p>Loading Profile...</p>
    </div>
}
else if (!isAuthorized)
{
    <div class="unauthorized-container">
        <div class="unauthorized-card">
            <div class="unauthorized-icon">🚫</div>
            <h3>Access Denied</h3>
            <p>You don't have permission to access this page.</p>
            <button class="btn btn-primary" @onclick="RedirectToHome">Return to Home</button>
        </div>
    </div>
}
else if (isLoading)
{
    <div class="loading-container">
        <div class="spinner"></div>
        <p>Loading Profile Data...</p>
    </div>
}
else
{
    <div class="student-profile">
        <!-- Header -->
        <div class="profile-header">
            <div class="header-content">
                <button class="back-btn" @onclick="GoBack">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 12H5M12 19l-7-7 7-7" />
                    </svg>
                    Back to Dashboard
                </button>
                <h1>Student Profile</h1>
                <div class="header-actions">
                    <button class="btn-icon" title="Refresh" @onclick="RefreshData">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 2v6h-6M3 12a9 9 0 0 1 15-6.7L21 8M3 22v-6h6M21 12a9 9 0 0 1-15 6.7L3 16" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="profile-content">
            <!-- Left Column - Personal Info & Stats -->
            <div class="left-column">
                <!-- Student Card -->
                <div class="profile-card">
                    <div class="student-card">
                        <div class="student-avatar">
                            <div class="avatar-circle">
                                <span class="avatar-initials">@GetUserInitials()</span>
                            </div>
                            @if (IsCafeteriaWorker)
                            {
                                <div class="worker-badge" title="Cafeteria Worker">
                                    🏢
                                </div>
                            }
                        </div>

                        <div class="student-info">
                            <h2 class="student-name">@studentProfile.Name @studentProfile.LastName</h2>
                            <div class="student-meta">
                                <div class="meta-item">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" />
                                    </svg>
                                    <span>Student</span>
                                </div>
                                <div class="meta-item">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
                                        <polyline points="9 22 9 12 15 12 15 22" />
                                    </svg>
                                    <span>Joined @joinDate.ToString("MMM yyyy")</span>
                                </div>
                            </div>

                            <div class="student-id">
                                <strong>Academic ID:</strong> @studentProfile.AcademicId
                            </div>

                            <div class="contact-info">
                                <div class="contact-item">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z" />
                                        <polyline points="22,6 12,13 2,6" />
                                    </svg>
                                    <a href="mailto:@studentProfile.Email">@studentProfile.Email</a>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="student-status">
                        @if (IsCafeteriaWorker && cafeteriaWorkerInfo != null)
                        {
                            <div class="status-card worker">
                                <div class="status-icon">🏢</div>
                                <div class="status-content">
                                    <h4>Cafeteria @cafeteriaWorkerInfo.Role</h4>
                                    <p>
                                        @if (cafeteriaWorkerInfo.IsActive)
                                        {
                                            <span class="status-active">Active</span>
                                        }
                                        else
                                        {
                                            <span class="status-inactive">Inactive</span>
                                        }
                                    </p>
                                </div>
                            </div>
                        }
                        else
                        {
                            <div class="status-card regular">
                                <div class="status-icon">🎓</div>
                                <div class="status-content">
                                    <h4>Regular Student</h4>
                                    <p>No campus employment</p>
                                </div>
                            </div>
                        }
                    </div>
                </div>

                <!-- Academic Overview -->
                <div class="profile-card">
                    <div class="card-header">
                        <h3>Academic Overview</h3>
                    </div>
                    <div class="card-content">
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-icon">📚</div>
                                <div class="stat-details">
                                    <div class="stat-value">@totalCourses</div>
                                    <div class="stat-label">Courses</div>
                                </div>
                            </div>

                            <div class="stat-card highlight">
                                <div class="stat-icon">⭐</div>
                                <div class="stat-details">
                                    <div class="stat-value">@overallGPA.ToString("F2")</div>
                                    <div class="stat-label">GPA</div>
                                </div>
                            </div>

                            <div class="stat-card">
                                <div class="stat-icon">✅</div>
                                <div class="stat-details">
                                    <div class="stat-value">@completedExercises</div>
                                    <div class="stat-label">Submissions</div>
                                </div>
                            </div>

                            <div class="stat-card">
                                <div class="stat-icon">📊</div>
                                <div class="stat-details">
                                    <div class="stat-value">@averageGrade.ToString("F1")</div>
                                    <div class="stat-label">Avg Grade</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Grade Performance -->
                @if (courseGrades.Any())
                {
                    <div class="profile-card">
                        <div class="card-header">
                            <h3>Grade Performance</h3>
                        </div>
                        <div class="card-content">
                            <div class="performance-metrics">
                                <div class="metric">
                                    <div class="metric-label">Average Grade</div>
                                    <div class="metric-value @GetGradeClass(averageGrade)">
                                        @averageGrade.ToString("F1")
                                    </div>
                                </div>
                                <div class="metric">
                                    <div class="metric-label">Highest Grade</div>
                                    <div class="metric-value grade-excellent">
                                        @bestGrade.ToString("F1")
                                    </div>
                                </div>
                                <div class="metric">
                                    <div class="metric-label">Total Credits</div>
                                    <div class="metric-value">@totalCredits</div>
                                </div>
                            </div>

                            <div class="grade-distribution">
                                <h4>Grade Distribution</h4>
                                <div class="distribution-bars">
                                    @foreach (var gradeRange in gradeDistribution)
                                    {
                                        <div class="distribution-item">
                                            <div class="range-label">@gradeRange.Range</div>
                                            <div class="bar-container">
                                                <div class="bar" style="width: @gradeRange.Percentage%"></div>
                                            </div>
                                            <div class="count">@gradeRange.Count</div>
                                        </div>
                                    }
                                </div>
                            </div>
                        </div>
                    </div>
                }

                <!-- Cafeteria Worker Details -->
                @if (IsCafeteriaWorker && cafeteriaWorkerInfo != null)
                {
                    <div class="profile-card">
                        <div class="card-header">
                            <h3>Cafeteria Employment</h3>
                        </div>
                        <div class="card-content">
                            <div class="employment-details">
                                <div class="detail-grid">
                                    <div class="detail-item">
                                        <div class="detail-label">Position</div>
                                        <div class="detail-value">@cafeteriaWorkerInfo.Role</div>
                                    </div>
                                    <div class="detail-item">
                                        <div class="detail-label">Status</div>
                                        <div class="detail-value">
                                            @if (cafeteriaWorkerInfo.IsActive)
                                            {
                                                <span class="status-badge active">Active</span>
                                            }
                                            else
                                            {
                                                <span class="status-badge inactive">Inactive</span>
                                            }
                                        </div>
                                    </div>
                                    <div class="detail-item">
                                        <div class="detail-label">Start Date</div>
                                        <div class="detail-value">@cafeteriaWorkerInfo.CreatedAt.ToString("MMM dd, yyyy")</div>
                                    </div>
                                    <div class="detail-item">
                                        <div class="detail-label">Employee Since</div>
                                        <div class="detail-value">@GetEmploymentDuration(cafeteriaWorkerInfo.CreatedAt)</div>
                                    </div>
                                </div>

                                <div class="benefits-section">
                                    <h4>Employee Benefits</h4>
                                    <div class="benefits-list">
                                        <div class="benefit-item">
                                            <span class="benefit-icon">🍽️</span>
                                            <span>Free meals during shifts</span>
                                        </div>
                                        <div class="benefit-item">
                                            <span class="benefit-icon">🏪</span>
                                            <span>Employee discount on purchases</span>
                                        </div>
                                        <div class="benefit-item">
                                            <span class="benefit-icon">⭐</span>
                                            <span>Priority access to campus facilities</span>
                                        </div>
                                        @if (cafeteriaWorkerInfo.Role != "Volunteer")
                                        {
                                            <div class="benefit-item">
                                                <span class="benefit-icon">💰</span>
                                                <span>Paid position with competitive wages</span>
                                            </div>
                                        }
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            </div>

            <!-- Right Column - Courses & Activities -->
            <div class="right-column">
                <!-- Current Courses -->
                <div class="profile-card">
                    <div class="card-header">
                        <h3>Current Courses (@enrolledCourses.Count)</h3>
                        <button class="btn-outline btn-sm" @onclick="BrowseCourses">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8" />
                                <line x1="21" y1="21" x2="16.65" y2="16.65" />
                                <line x1="11" y1="8" x2="11" y2="14" />
                                <line x1="8" y1="11" x2="14" y2="11" />
                            </svg>
                            Browse More
                        </button>
                    </div>
                    <div class="card-content">
                        @if (enrolledCourses.Any())
                        {
                            <div class="courses-list">
                                @foreach (var course in enrolledCourses)
                                {
                                    <div class="course-card">
                                        <div class="course-header">
                                            <div class="course-title-section">
                                                <h4 class="course-title">@course.CourseName</h4>
                                                <span class="course-professor">Prof. @course.ProfessorName</span>
                                            </div>
                                            @if (course.Grade.HasValue)
                                            {
                                                <div class="course-grade @GetGradeClass(course.Grade.Value)">
                                                    @course.Grade.Value.ToString("F1")
                                                </div>
                                            }
                                        </div>

                                        <div class="course-progress">
                                            <div class="progress-info">
                                                <span>Progress: @course.CompletedExercises/@course.TotalExercises exercises</span>
                                                <span>@course.ProgressPercentage%</span>
                                            </div>
                                            <div class="progress-bar">
                                                <div class="progress-fill" style="width: @course.ProgressPercentage%"></div>
                                            </div>
                                        </div>

                                        <div class="course-meta">
                                            <div class="meta-item">
                                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                    <circle cx="12" cy="12" r="10" />
                                                    <polyline points="12 6 12 12 16 14" />
                                                </svg>
                                                <span>Enrolled @course.EnrollmentDate.ToString("MMM dd")</span>
                                            </div>
                                            <div class="meta-item">
                                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                    <path d="M12 20h9" />
                                                    <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z" />
                                                </svg>
                                                <span>@course.PendingAssignments pending</span>
                                            </div>
                                        </div>
                                    </div>
                                }
                            </div>
                        }
                        else
                        {
                            <div class="empty-state">
                                <div class="empty-icon">📚</div>
                                <h4>No Course Enrollments</h4>
                                <p>You are not currently enrolled in any courses.</p>
                                <button class="btn-primary" @onclick="BrowseCourses">
                                    Browse Available Courses
                                </button>
                            </div>
                        }
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="profile-card">
                    <div class="card-header">
                        <h3>Recent Activity</h3>
                    </div>
                    <div class="card-content">
                        <div class="activity-tabs">
                            <button class="tab @(activeTab == "submissions" ? "active" : "")"
                                    @onclick='() => SwitchTab("submissions")'>
                                Submissions
                            </button>
                            <button class="tab @(activeTab == "deadlines" ? "active" : "")"
                                    @onclick='() => SwitchTab("deadlines")'>
                                Deadlines
                            </button>
                            <button class="tab @(activeTab == "announcements" ? "active" : "")"
                                    @onclick='() => SwitchTab("announcements")'>
                                Announcements
                            </button>
                        </div>

                        <div class="activity-content">
                            @if (activeTab == "submissions")
                            {
                                @if (recentSubmissions.Any())
                                {
                                    <div class="submissions-list">
                                        @foreach (var submission in recentSubmissions)
                                        {
                                            <div class="activity-item">
                                                <div class="activity-icon">
                                                    @if (submission.Grade.HasValue)
                                                    {
                                                        <div class="icon-circle success">
                                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                                <polyline points="20 6 9 17 4 12" />
                                                            </svg>
                                                        </div>
                                                    }
                                                    else
                                                    {
                                                        <div class="icon-circle pending">
                                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                                <circle cx="12" cy="12" r="10" />
                                                                <line x1="12" y1="8" x2="12" y2="12" />
                                                                <line x1="12" y1="16" x2="12.01" y2="16" />
                                                            </svg>
                                                        </div>
                                                    }
                                                </div>
                                                <div class="activity-details">
                                                    <div class="activity-title">
                                                        <strong>@submission.ExerciseTitle</strong>
                                                        <span class="activity-time">@GetTimeAgo(submission.SubmittedAt)</span>
                                                    </div>
                                                    <div class="activity-description">
                                                        @submission.CourseName
                                                        @if (submission.Grade.HasValue)
                                                        {
                                                            <span class="activity-grade @GetGradeClass(submission.Grade.Value)">
                                                                @submission.Grade.Value.ToString("F1")/@submission.MaxPoints
                                                            </span>
                                                        }
                                                        else
                                                        {
                                                            <span class="activity-status">Awaiting grade</span>
                                                        }
                                                    </div>
                                                </div>
                                            </div>
                                        }
                                    </div>
                                }
                                else
                                {
                                    <div class="empty-list">
                                        <p>No submissions yet</p>
                                    </div>
                                }
                            }
                            else if (activeTab == "deadlines")
                            {
                                @if (upcomingDueDates.Any())
                                {
                                    <div class="deadlines-list">
                                        @foreach (var deadline in upcomingDueDates)
                                        {
                                            <div class="deadline-item @(deadline.IsUrgent ? "urgent" : "")">
                                                <div class="deadline-date">
                                                    <div class="date-day">@deadline.DueDate.ToString("dd")</div>
                                                    <div class="date-month">@deadline.DueDate.ToString("MMM")</div>
                                                </div>
                                                <div class="deadline-details">
                                                    <div class="deadline-title">@deadline.Title</div>
                                                    <div class="deadline-info">
                                                        <span class="deadline-course">@deadline.CourseName</span>
                                                        <span class="deadline-points">@deadline.MaxPoints pts</span>
                                                    </div>
                                                    <div class="deadline-status">
                                                        @if (deadline.IsSubmitted)
                                                        {
                                                            <span class="status-submitted">Submitted</span>
                                                        }
                                                        else
                                                        {
                                                            <span class="status-pending">Due @GetDueTimeText(deadline.DueDate)</span>
                                                        }
                                                    </div>
                                                </div>
                                            </div>
                                        }
                                    </div>
                                }
                                else
                                {
                                    <div class="empty-list">
                                        <p>No upcoming deadlines</p>
                                    </div>
                                }
                            }
                            else if (activeTab == "announcements")
                            {
                                @if (recentAnnouncements.Any())
                                {
                                    <div class="announcements-list">
                                        @foreach (var announcement in recentAnnouncements)
                                        {
                                            <div class="announcement-item">
                                                <div class="announcement-icon">
                                                    @if (announcement.Priority == "High")
                                                    {
                                                        <span class="priority-high">⚠️</span>
                                                    }
                                                    else if (announcement.Priority == "Medium")
                                                    {
                                                        <span class="priority-medium">📢</span>
                                                    }
                                                    else
                                                    {
                                                        <span class="priority-low">📝</span>
                                                    }
                                                </div>
                                                <div class="announcement-details">
                                                    <div class="announcement-title">
                                                        @announcement.Title
                                                        <span class="announcement-time">@GetTimeAgo(announcement.CreatedAt)</span>
                                                    </div>
                                                    <div class="announcement-description">
                                                        @announcement.CourseName • @announcement.ProfessorName
                                                    </div>
                                                </div>
                                            </div>
                                        }
                                    </div>
                                }
                                else
                                {
                                    <div class="empty-list">
                                        <p>No recent announcements</p>
                                    </div>
                                }
                            }
                        </div>
                    </div>
                </div>

                <!-- Campus Engagement -->
                <div class="profile-card">
                    <div class="card-header">
                        <h3>Campus Engagement</h3>
                    </div>
                    <div class="card-content">
                        <div class="engagement-stats">
                            <div class="engagement-card">
                                <div class="engagement-icon rating">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2" />
                                    </svg>
                                </div>
                                <div class="engagement-content">
                                    <div class="engagement-value">@professorsRated</div>
                                    <div class="engagement-label">Professors Rated</div>
                                </div>
                            </div>

                            <div class="engagement-card">
                                <div class="engagement-icon comment">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" />
                                    </svg>
                                </div>
                                <div class="engagement-content">
                                    <div class="engagement-value">@commentsPosted</div>
                                    <div class="engagement-label">Comments Posted</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
}

@code {
    private bool isAuthChecked = false;
    private bool isAuthorized = false;
    private bool isLoading = true;
    private string activeTab = "submissions";

    // Student Profile Data
    private User studentProfile = new();
    private DateTime joinDate = DateTime.Now;

    // Academic Stats (REAL DATA from database)
    private int totalCourses = 0;
    private double overallGPA = 0.0; // REAL: Calculated from actual grades
    private int completedExercises = 0; // REAL: From ExerciseSubmissions table
    private double bestGrade = 0.0; // REAL: From Grades table
    private double averageGrade = 0.0; // REAL: From Grades table
    private int totalCredits = 0;

    // Cafeteria Worker Info (REAL DATA from CafeteriaWorkers table)
    private bool IsCafeteriaWorker = false;
    private CafeteriaWorkerInfo? cafeteriaWorkerInfo;

    // Course Data (REAL DATA)
    private List<EnrollmentView> enrolledCourses = new();
    private List<CourseGrade> courseGrades = new();

    // Activity Data (REAL DATA)
    private List<SubmissionView> recentSubmissions = new();
    private List<DueDateView> upcomingDueDates = new();
    private List<AnnouncementView> recentAnnouncements = new();

    // Engagement Stats (REAL DATA)
    private int professorsRated = 0; // REAL: From ProfessorRatings table
    private int commentsPosted = 0; // REAL: From Comments table

    // Grade Distribution (REAL DATA calculated from Grades)
    private List<GradeDistribution> gradeDistribution = new();

    protected override async Task OnInitializedAsync()
    {
        await CheckAuthorization();
        if (isAuthorized)
        {
            await LoadStudentProfile();
            await LoadAcademicData();
            await LoadEnrollments();
            await LoadActivityData();
            await LoadEngagementStats();

            isLoading = false;
        }
    }

    private async Task CheckAuthorization()
    {
        // Wait for AuthStateService to load
        for (int i = 0; i < 30; i++)
        {
            if (AuthStateService.CurrentUser != null)
                break;
            await Task.Delay(100);
        }

        var user = AuthStateService.CurrentUser;
        isAuthorized = user != null && (user.Role == "Student" || user.Role == "Admin");
        isAuthChecked = true;
        await InvokeAsync(StateHasChanged);
    }

    private async Task LoadStudentProfile()
    {
        try
        {
            var currentUser = AuthStateService.CurrentUser;
            if (currentUser == null) return;

            // Load student profile from database to get complete info
            var student = await Context.Users
                .FirstOrDefaultAsync(u => u.Id == currentUser.Id);

            if (student != null)
            {
                studentProfile = student;
                joinDate = student.CreatedAt;

                // Check cafeteria worker status (REAL DATA)
                var cafeteriaWorker = await Context.CafeteriaWorkers
                    .FirstOrDefaultAsync(cw => cw.StudentId == currentUser.Id);

                IsCafeteriaWorker = cafeteriaWorker != null;

                if (IsCafeteriaWorker && cafeteriaWorker != null)
                {
                    cafeteriaWorkerInfo = new CafeteriaWorkerInfo
                    {
                        WorkerId = cafeteriaWorker.Id,
                        Role = cafeteriaWorker.Role,
                        IsActive = cafeteriaWorker.IsActive,
                        CreatedAt = cafeteriaWorker.CreatedAt
                    };
                }
            }
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error loading profile: {ex.Message}");
        }
    }

    private async Task LoadAcademicData()
    {
        try
        {
            var currentUser = AuthStateService.CurrentUser;
            if (currentUser == null) return;

            // Load grades (REAL DATA from Grades table)
            var grades = await Context.Grades
                .Where(g => g.StudentId == currentUser.Id)
                .Include(g => g.Course)
                .ToListAsync();

            courseGrades = grades.Select(g => new CourseGrade
            {
                CourseId = g.CourseId,
                CourseName = g.Course?.Name ?? "Unknown Course",
                Grade = g.GradeValue
            }).ToList();

            // Calculate stats from REAL DATA
            totalCourses = courseGrades.Select(g => g.CourseId).Distinct().Count();
            if (courseGrades.Any())
            {
                // For GPA: Use actual grades (0-10 scale) and convert properly
                // If you want true GPA (4.0 scale), you'll need a conversion table
                // For now, showing the average grade on 0-10 scale
                averageGrade = courseGrades.Average(g => g.Grade);
                bestGrade = courseGrades.Max(g => g.Grade);

                // Calculate GPA on 4.0 scale based on 0-10 grades
                overallGPA = CalculateGPA(averageGrade);
                totalCredits = totalCourses * 3; // Assume 3 credits per course
            }

            // Calculate grade distribution from REAL DATA
            CalculateGradeDistribution();
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error loading academic data: {ex.Message}");
        }
    }

    private double CalculateGPA(double averageGrade)
    {
        // Convert 0-10 scale to 4.0 GPA scale
        if (averageGrade >= 9.0) return 4.0; // A
        if (averageGrade >= 8.5) return 3.7; // A-
        if (averageGrade >= 8.0) return 3.3; // B+
        if (averageGrade >= 7.5) return 3.0; // B
        if (averageGrade >= 7.0) return 2.7; // B-
        if (averageGrade >= 6.5) return 2.3; // C+
        if (averageGrade >= 6.0) return 2.0; // C
        if (averageGrade >= 5.5) return 1.7; // C-
        if (averageGrade >= 5.0) return 1.3; // D+
        if (averageGrade >= 4.5) return 1.0; // D
        return 0.0; // F
    }

    private async Task LoadEnrollments()
    {
        try
        {
            var currentUser = AuthStateService.CurrentUser;
            if (currentUser == null) return;

            // Load enrollments with related data (REAL DATA)
            var enrollments = await Context.Enrollments
                .Where(e => e.StudentId == currentUser.Id)
                .Include(e => e.Course)
                    .ThenInclude(c => c.Professor)
                .OrderByDescending(e => e.EnrollmentDate)
                .ToListAsync();

            enrolledCourses = new List<EnrollmentView>();

            foreach (var enrollment in enrollments)
            {
                var courseId = enrollment.CourseId;
                var grade = await GetCourseGrade(courseId);
                var totalExercises = await GetTotalExercises(courseId);
                var completedExercises = await GetCompletedExercises(courseId);
                var pendingAssignments = totalExercises - completedExercises;

                enrolledCourses.Add(new EnrollmentView
                {
                    EnrollmentId = enrollment.Id,
                    CourseId = courseId,
                    CourseName = enrollment.Course?.Name ?? "Unknown Course",
                    ProfessorName = enrollment.Course?.Professor?.Name ?? "Unknown Professor",
                    EnrollmentDate = enrollment.EnrollmentDate,
                    Grade = grade,
                    TotalExercises = totalExercises,
                    CompletedExercises = completedExercises,
                    PendingAssignments = pendingAssignments,
                    ProgressPercentage = totalExercises > 0
                        ? (int)((double)completedExercises / totalExercises * 100)
                        : 0
                });
            }
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error loading enrollments: {ex.Message}");
        }
    }

    private async Task LoadActivityData()
    {
        try
        {
            var currentUser = AuthStateService.CurrentUser;
            if (currentUser == null) return;

            // Load recent submissions (REAL DATA)
            var submissions = await Context.ExerciseSubmissions
                .Where(s => s.StudentId == currentUser.Id)
                .Include(s => s.Exercise)
                    .ThenInclude(e => e.Course)
                .OrderByDescending(s => s.SubmittedAt)
                .Take(5)
                .ToListAsync();

            recentSubmissions = submissions.Select(s => new SubmissionView
            {
                SubmissionId = s.Id,
                ExerciseId = s.ExerciseId,
                ExerciseTitle = s.Exercise?.Title ?? "Unknown Exercise",
                CourseName = s.Exercise?.Course?.Name ?? "Unknown Course",
                SubmittedAt = s.SubmittedAt,
                Grade = s.Grade,
                MaxPoints = s.Exercise?.MaxPoints ?? 0
            }).ToList();

            completedExercises = await Context.ExerciseSubmissions
                .CountAsync(s => s.StudentId == currentUser.Id);

            // Load upcoming due dates (REAL DATA)
            var today = DateTime.Now.Date;
            var nextWeek = today.AddDays(14);

            // Get all exercises for enrolled courses
            var enrolledCourseIds = enrolledCourses.Select(ec => ec.CourseId).ToList();
            var exercises = await Context.Exercises
                .Where(e => e.IsPublished && enrolledCourseIds.Contains(e.CourseId))
                .Include(e => e.Course)
                .ToListAsync();

            upcomingDueDates = exercises
                .Where(e => e.DueDate >= today && e.DueDate <= nextWeek)
                .Select(e => new DueDateView
                {
                    ExerciseId = e.Id,
                    Title = e.Title,
                    CourseName = e.Course?.Name ?? "Unknown Course",
                    DueDate = e.DueDate,
                    MaxPoints = e.MaxPoints,
                    IsSubmitted = recentSubmissions.Any(s => s.ExerciseId == e.Id),
                    IsUrgent = e.DueDate.Date <= today.AddDays(3)
                })
                .OrderBy(e => e.DueDate)
                .Take(5)
                .ToList();

            // Load recent announcements for enrolled courses (REAL DATA)
            if (enrolledCourseIds.Any())
            {
                var announcements = await Context.Announcements
                    .Where(a => enrolledCourseIds.Contains(a.CourseId))
                    .Include(a => a.Professor)
                    .Include(a => a.Course)
                    .OrderByDescending(a => a.CreatedAt)
                    .Take(5)
                    .ToListAsync();

                recentAnnouncements = announcements.Select(a => new AnnouncementView
                {
                    Id = a.Id,
                    Title = a.Title,
                    Content = a.Content,
                    CourseName = a.Course?.Name ?? "Unknown Course",
                    ProfessorName = a.Professor?.Name ?? "Unknown Professor",
                    Priority = a.Priority,
                    CreatedAt = a.CreatedAt
                }).ToList();
            }
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error loading activity data: {ex.Message}");
        }
    }

    private async Task LoadEngagementStats()
    {
        try
        {
            var currentUser = AuthStateService.CurrentUser;
            if (currentUser == null) return;

            // Count professors rated (REAL DATA)
            professorsRated = await Context.ProfessorRatings
                .CountAsync(r => r.StudentId == currentUser.Id);

            // Count comments posted (REAL DATA)
            commentsPosted = await Context.Comments
                .CountAsync(c => c.StudentId == currentUser.Id && c.IsApproved);
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error loading engagement stats: {ex.Message}");
        }
    }

    private async Task<double?> GetCourseGrade(int courseId)
    {
        try
        {
            var grade = await Context.Grades
                .FirstOrDefaultAsync(g => g.StudentId == studentProfile.Id && g.CourseId == courseId);

            return grade?.GradeValue;
        }
        catch
        {
            return null;
        }
    }

    private async Task<int> GetTotalExercises(int courseId)
    {
        try
        {
            return await Context.Exercises
                .CountAsync(e => e.CourseId == courseId && e.IsPublished);
        }
        catch
        {
            return 0;
        }
    }

    private async Task<int> GetCompletedExercises(int courseId)
    {
        try
        {
            return await Context.ExerciseSubmissions
                .CountAsync(s => s.StudentId == studentProfile.Id && s.Exercise != null && s.Exercise.CourseId == courseId);
        }
        catch
        {
            return 0;
        }
    }

    private void CalculateGradeDistribution()
    {
        gradeDistribution.Clear();

        var ranges = new[]
        {
            new { Range = "9-10", Min = 9.0, Max = 10.0 },
            new { Range = "8-8.9", Min = 8.0, Max = 8.9 },
            new { Range = "7-7.9", Min = 7.0, Max = 7.9 },
            new { Range = "6-6.9", Min = 6.0, Max = 6.9 },
            new { Range = "0-5.9", Min = 0.0, Max = 5.9 }
        };

        foreach (var range in ranges)
        {
            var count = courseGrades.Count(g => g.Grade >= range.Min && g.Grade <= range.Max);
            var percentage = courseGrades.Any() ? (count * 100.0 / courseGrades.Count) : 0;

            gradeDistribution.Add(new GradeDistribution
            {
                Range = range.Range,
                Count = count,
                Percentage = percentage
            });
        }
    }

    private string GetEmploymentDuration(DateTime startDate)
    {
        var duration = DateTime.Now - startDate;

        if (duration.TotalDays >= 365)
        {
            var years = (int)(duration.TotalDays / 365);
            return $"{years} year{(years > 1 ? "s" : "")}";
        }

        if (duration.TotalDays >= 30)
        {
            var months = (int)(duration.TotalDays / 30);
            return $"{months} month{(months > 1 ? "s" : "")}";
        }

        var weeks = (int)(duration.TotalDays / 7);
        if (weeks > 0)
        {
            return $"{weeks} week{(weeks > 1 ? "s" : "")}";
        }

        return "Recently started";
    }

    private string GetGradeClass(double grade)
    {
        if (grade >= 9.0) return "grade-excellent";
        if (grade >= 8.0) return "grade-good";
        if (grade >= 7.0) return "grade-average";
        if (grade >= 6.0) return "grade-pass";
        return "grade-fail";
    }

    private string GetDueTimeText(DateTime dueDate)
    {
        var diff = dueDate - DateTime.Now;

        if (diff.TotalDays < 0) return "Overdue";
        if (diff.TotalDays < 1) return "Today";
        if (diff.TotalDays < 2) return "Tomorrow";
        if (diff.TotalDays < 7) return $"in {diff.Days} days";

        return dueDate.ToString("MMM dd");
    }

    private string GetTimeAgo(DateTime date)
    {
        var diff = DateTime.Now - date;

        if (diff.TotalDays >= 30)
        {
            var months = (int)(diff.TotalDays / 30);
            return $"{months} month{(months > 1 ? "s" : "")} ago";
        }

        if (diff.TotalDays >= 1)
        {
            var days = (int)diff.TotalDays;
            return $"{days} day{(days > 1 ? "s" : "")} ago";
        }

        if (diff.TotalHours >= 1)
        {
            var hours = (int)diff.TotalHours;
            return $"{hours} hour{(hours > 1 ? "s" : "")} ago";
        }

        if (diff.TotalMinutes >= 1)
        {
            var minutes = (int)diff.TotalMinutes;
            return $"{minutes} minute{(minutes > 1 ? "s" : "")} ago";
        }

        return "Just now";
    }

    private string GetUserInitials()
    {
        var name = studentProfile.Name ?? "";
        var lastName = studentProfile.LastName ?? "";

        if (!string.IsNullOrEmpty(name) && !string.IsNullOrEmpty(lastName))
            return $"{name[0]}{lastName[0]}".ToUpper();

        if (!string.IsNullOrEmpty(name))
            return name.Length >= 2 ? name.Substring(0, 2).ToUpper() : name.ToUpper();

        return "S";
    }

    private void SwitchTab(string tab)
    {
        activeTab = tab;
        StateHasChanged();
    }

    private void GoBack()
    {
        Navigation.NavigateTo("/studenthome");
    }

    private void RedirectToHome()
    {
        Navigation.NavigateTo("/");
    }

    private void BrowseCourses()
    {
        Navigation.NavigateTo("/courses");
    }

    private async void RefreshData()
    {
        isLoading = true;
        StateHasChanged();

        await Task.Delay(500);

        await LoadStudentProfile();
        await LoadAcademicData();
        await LoadEnrollments();
        await LoadActivityData();
        await LoadEngagementStats();

        isLoading = false;
        StateHasChanged();
    }

    // View Model Classes
    public class CafeteriaWorkerInfo
    {
        public int WorkerId { get; set; }
        public string Role { get; set; } = "";
        public bool IsActive { get; set; }
        public DateTime CreatedAt { get; set; }
    }

    public class CourseGrade
    {
        public int CourseId { get; set; }
        public string CourseName { get; set; } = "";
        public double Grade { get; set; }
    }

    public class EnrollmentView
    {
        public int EnrollmentId { get; set; }
        public int CourseId { get; set; }
        public string CourseName { get; set; } = "";
        public string ProfessorName { get; set; } = "";
        public DateTime EnrollmentDate { get; set; }
        public double? Grade { get; set; }
        public int TotalExercises { get; set; }
        public int CompletedExercises { get; set; }
        public int PendingAssignments { get; set; }
        public int ProgressPercentage { get; set; }
    }

    public class SubmissionView
    {
        public int SubmissionId { get; set; }
        public int ExerciseId { get; set; }
        public string ExerciseTitle { get; set; } = "";
        public string CourseName { get; set; } = "";
        public DateTime SubmittedAt { get; set; }
        public double? Grade { get; set; }
        public double MaxPoints { get; set; }
    }

    public class DueDateView
    {
        public int ExerciseId { get; set; }
        public string Title { get; set; } = "";
        public string CourseName { get; set; } = "";
        public DateTime DueDate { get; set; }
        public double MaxPoints { get; set; }
        public bool IsSubmitted { get; set; }
        public bool IsUrgent { get; set; }
    }

    public class AnnouncementView
    {
        public int Id { get; set; }
        public string Title { get; set; } = "";
        public string Content { get; set; } = "";
        public string CourseName { get; set; } = "";
        public string ProfessorName { get; set; } = "";
        public string Priority { get; set; } = "";
        public DateTime CreatedAt { get; set; }
    }

    public class GradeDistribution
    {
        public string Range { get; set; } = "";
        public int Count { get; set; }
        public double Percentage { get; set; }
    }
}
<style>
    .student-profile {
        min-height: 100vh;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        padding: 20px;
    }

    .profile-header {
        background: white;
        border-radius: 12px;
        margin-bottom: 20px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .header-content {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 20px;
    }

    .back-btn {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 8px 16px;
        background: #f8fafc;
        border: 1px solid #e2e8f0;
        border-radius: 8px;
        color: #475569;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
    }

        .back-btn:hover {
            background: #f1f5f9;
            border-color: #cbd5e1;
        }

    .profile-header h1 {
        margin: 0;
        font-size: 24px;
        font-weight: 700;
        color: #1e293b;
    }

    .header-actions {
        display: flex;
        gap: 8px;
    }

    .btn-icon {
        width: 36px;
        height: 36px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: #f8fafc;
        border: 1px solid #e2e8f0;
        border-radius: 8px;
        color: #475569;
        cursor: pointer;
        transition: all 0.2s;
    }

        .btn-icon:hover {
            background: #f1f5f9;
            border-color: #cbd5e1;
        }

    .profile-content {
        display: grid;
        grid-template-columns: 1fr 1.5fr;
        gap: 20px;
    }

    @@media (max-width: 1024px) {
        .profile-content

    {
        grid-template-columns: 1fr;
    }

    }

    /* Cards */
    .profile-card {
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        margin-bottom: 20px;
        overflow: hidden;
    }

    .card-header {
        padding: 20px;
        border-bottom: 1px solid #f1f5f9;
        display: flex;
        align-items: center;
        justify-content: space-between;
    }

        .card-header h3 {
            margin: 0;
            font-size: 18px;
            font-weight: 600;
            color: #1e293b;
        }

    .card-content {
        padding: 20px;
    }

    /* Student Card */
    .student-card {
        text-align: center;
        padding: 20px 0;
    }

    .student-avatar {
        position: relative;
        display: inline-block;
        margin-bottom: 20px;
    }

    .avatar-circle {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 32px;
        font-weight: 600;
    }

    .worker-badge {
        position: absolute;
        bottom: 0;
        right: 0;
        background: #10b981;
        color: white;
        width: 32px;
        height: 32px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 16px;
        border: 3px solid white;
    }

    .student-name {
        margin: 0 0 8px 0;
        font-size: 24px;
        font-weight: 700;
        color: #1e293b;
    }

    .student-meta {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin-bottom: 12px;
    }

    .meta-item {
        display: flex;
        align-items: center;
        gap: 6px;
        color: #64748b;
        font-size: 14px;
    }

    .student-id {
        color: #475569;
        font-size: 14px;
        margin-bottom: 16px;
    }

    .contact-info {
        display: flex;
        justify-content: center;
    }

    .contact-item {
        display: flex;
        align-items: center;
        gap: 8px;
        color: #3b82f6;
        font-size: 14px;
    }

        .contact-item a {
            color: #3b82f6;
            text-decoration: none;
        }

            .contact-item a:hover {
                text-decoration: underline;
            }

    /* Status Cards */
    .student-status {
        margin-top: 20px;
    }

    .status-card {
        display: flex;
        align-items: center;
        gap: 16px;
        padding: 16px;
        border-radius: 8px;
    }

        .status-card.worker {
            background: linear-gradient(135deg, #dbeafe 0%, #d1d5db 100%);
            border: 1px solid #bfdbfe;
        }

        .status-card.regular {
            background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
            border: 1px solid #d1d5db;
        }

    .status-icon {
        font-size: 32px;
    }

    .status-content h4 {
        margin: 0 0 4px 0;
        font-size: 16px;
        font-weight: 600;
        color: #1e293b;
    }

    .status-content p {
        margin: 0;
        font-size: 14px;
        color: #64748b;
    }

    .status-active {
        color: #10b981;
        font-weight: 500;
    }

    .status-inactive {
        color: #64748b;
    }

    /* Stats Grid */
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
    }

    .stat-card {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 16px;
        background: #f8fafc;
        border-radius: 8px;
        border: 1px solid #e2e8f0;
    }

        .stat-card.highlight {
            background: linear-gradient(135deg, #dbeafe 0%, #93c5fd 100%);
            border-color: #60a5fa;
        }

    .stat-icon {
        font-size: 24px;
    }

    .stat-details {
        flex: 1;
    }

    .stat-value {
        font-size: 24px;
        font-weight: 700;
        color: #1e293b;
        line-height: 1;
    }

    .stat-label {
        font-size: 12px;
        color: #64748b;
        margin-top: 4px;
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }

    /* Performance Metrics */
    .performance-metrics {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 16px;
        margin-bottom: 24px;
    }

    .metric {
        text-align: center;
        padding: 12px;
        background: #f8fafc;
        border-radius: 8px;
    }

    .metric-label {
        font-size: 12px;
        color: #64748b;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        margin-bottom: 4px;
    }

    .metric-value {
        font-size: 20px;
        font-weight: 700;
    }

    .grade-excellent {
        color: #10b981;
    }

    .grade-good {
        color: #3b82f6;
    }

    .grade-average {
        color: #f59e0b;
    }

    .grade-pass {
        color: #8b5cf6;
    }

    .grade-fail {
        color: #ef4444;
    }

    /* Grade Distribution */
    .grade-distribution h4 {
        margin: 0 0 12px 0;
        font-size: 14px;
        font-weight: 600;
        color: #475569;
    }

    .distribution-bars {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    .distribution-item {
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .range-label {
        width: 50px;
        font-size: 12px;
        color: #64748b;
        font-weight: 500;
    }

    .bar-container {
        flex: 1;
        height: 8px;
        background: #e2e8f0;
        border-radius: 4px;
        overflow: hidden;
    }

    .bar {
        height: 100%;
        background: linear-gradient(90deg, #3b82f6, #8b5cf6);
        border-radius: 4px;
    }

    .count {
        width: 30px;
        font-size: 12px;
        font-weight: 600;
        color: #1e293b;
        text-align: right;
    }

    /* Employment Details */
    .employment-details {
        padding: 4px;
    }

    .detail-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 16px;
        margin-bottom: 24px;
    }

    .detail-item {
        display: flex;
        flex-direction: column;
        gap: 4px;
    }

    .detail-label {
        font-size: 12px;
        color: #64748b;
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }

    .detail-value {
        font-size: 14px;
        font-weight: 500;
        color: #1e293b;
    }

    .status-badge {
        display: inline-block;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }

        .status-badge.active {
            background: #d1fae5;
            color: #065f46;
        }

        .status-badge.inactive {
            background: #f3f4f6;
            color: #374151;
        }

    .benefits-section h4 {
        margin: 0 0 12px 0;
        font-size: 14px;
        font-weight: 600;
        color: #475569;
    }

    .benefits-list {
        display: flex;
        flex-direction: column;
        gap: 8px;
        margin-bottom: 20px;
    }

    .benefit-item {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 14px;
        color: #475569;
    }

    .benefit-icon {
        font-size: 16px;
    }

    .employment-actions {
        display: flex;
        gap: 12px;
        margin-top: 16px;
    }

    /* Courses */
    .btn-outline {
        display: flex;
        align-items: center;
        gap: 6px;
        padding: 8px 16px;
        background: white;
        border: 1px solid #e2e8f0;
        border-radius: 8px;
        color: #475569;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
    }

        .btn-outline:hover {
            background: #f8fafc;
            border-color: #cbd5e1;
        }

    .btn-sm {
        padding: 6px 12px;
        font-size: 13px;
    }

    .courses-list {
        display: flex;
        flex-direction: column;
        gap: 12px;
    }

    .course-card {
        padding: 16px;
        background: #f8fafc;
        border-radius: 8px;
        border: 1px solid #e2e8f0;
    }

    .course-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 12px;
    }

    .course-title-section {
        flex: 1;
    }

    .course-title {
        margin: 0 0 4px 0;
        font-size: 16px;
        font-weight: 600;
        color: #1e293b;
    }

    .course-professor {
        font-size: 13px;
        color: #64748b;
    }

    .course-grade {
        font-size: 18px;
        font-weight: 700;
        padding: 4px 8px;
        border-radius: 6px;
        background: white;
        border: 1px solid #e2e8f0;
    }

    .course-progress {
        margin-bottom: 12px;
    }

    .progress-info {
        display: flex;
        justify-content: space-between;
        font-size: 12px;
        color: #64748b;
        margin-bottom: 4px;
    }

    .progress-bar {
        height: 6px;
        background: #e2e8f0;
        border-radius: 3px;
        overflow: hidden;
    }

    .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #10b981, #3b82f6);
        border-radius: 3px;
    }

    .course-meta {
        display: flex;
        gap: 16px;
    }

        .course-meta .meta-item {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 12px;
            color: #64748b;
        }

    .empty-state {
        text-align: center;
        padding: 40px 20px;
    }

    .empty-icon {
        font-size: 48px;
        opacity: 0.3;
        margin-bottom: 16px;
    }

    .empty-state h4 {
        margin: 0 0 8px 0;
        font-size: 16px;
        font-weight: 600;
        color: #475569;
    }

    .empty-state p {
        margin: 0 0 20px 0;
        color: #64748b;
        font-size: 14px;
    }

    .btn-primary {
        display: inline-block;
        padding: 10px 20px;
        background: #3b82f6;
        border: none;
        border-radius: 8px;
        color: white;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
    }

        .btn-primary:hover {
            background: #2563eb;
        }

    /* Activity Tabs */
    .activity-tabs {
        display: flex;
        gap: 8px;
        margin-bottom: 20px;
        border-bottom: 1px solid #e2e8f0;
        padding-bottom: 12px;
    }

    .tab {
        padding: 8px 16px;
        background: none;
        border: none;
        color: #64748b;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        border-radius: 6px;
        transition: all 0.2s;
    }

        .tab:hover {
            background: #f1f5f9;
            color: #475569;
        }

        .tab.active {
            background: #3b82f6;
            color: white;
        }

    /* Activity Items */
    .activity-content {
        min-height: 200px;
    }

    .activity-item, .deadline-item, .announcement-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px;
        border-radius: 8px;
        margin-bottom: 8px;
        transition: all 0.2s;
    }

        .activity-item:hover, .deadline-item:hover, .announcement-item:hover {
            background: #f8fafc;
        }

    .icon-circle {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
    }

        .icon-circle.success {
            background: #d1fae5;
            color: #059669;
        }

        .icon-circle.pending {
            background: #fef3c7;
            color: #d97706;
        }

    .activity-details {
        flex: 1;
    }

    .activity-title {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 4px;
    }

        .activity-title strong {
            font-size: 14px;
            color: #1e293b;
        }

    .activity-time {
        font-size: 12px;
        color: #64748b;
    }

    .activity-description {
        display: flex;
        align-items: center;
        justify-content: space-between;
        font-size: 13px;
        color: #64748b;
    }

    .activity-grade {
        font-weight: 600;
        padding: 2px 6px;
        border-radius: 4px;
        background: #f8fafc;
        border: 1px solid #e2e8f0;
    }

    .activity-status {
        color: #f59e0b;
        font-weight: 500;
    }

    /* Deadlines */
    .deadline-item {
        align-items: flex-start;
    }

        .deadline-item.urgent {
            background: #fffbeb;
            border: 1px solid #fde68a;
        }

    .deadline-date {
        text-align: center;
        padding: 8px;
        background: #f1f5f9;
        border-radius: 6px;
        min-width: 50px;
    }

    .date-day {
        font-size: 18px;
        font-weight: 700;
        color: #1e293b;
        line-height: 1;
    }

    .date-month {
        font-size: 12px;
        color: #64748b;
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }

    .deadline-details {
        flex: 1;
    }

    .deadline-title {
        font-size: 14px;
        font-weight: 600;
        color: #1e293b;
        margin-bottom: 4px;
    }

    .deadline-info {
        display: flex;
        align-items: center;
        justify-content: space-between;
        font-size: 12px;
        color: #64748b;
        margin-bottom: 4px;
    }

    .deadline-points {
        font-weight: 600;
        color: #1e293b;
    }

    .deadline-status {
        font-size: 12px;
    }

    .status-submitted {
        color: #10b981;
        font-weight: 500;
    }

    .status-pending {
        color: #f59e0b;
        font-weight: 500;
    }

    /* Announcements */
    .announcement-icon {
        font-size: 20px;
    }

    .priority-high {
        color: #ef4444;
    }

    .priority-medium {
        color: #f59e0b;
    }

    .priority-low {
        color: #3b82f6;
    }

    .announcement-title {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 4px;
        font-size: 14px;
        color: #1e293b;
        font-weight: 500;
    }

    .announcement-description {
        font-size: 12px;
        color: #64748b;
    }

    .empty-list {
        text-align: center;
        padding: 40px 20px;
        color: #94a3b8;
        font-style: italic;
    }

    /* Engagement Stats */
    .engagement-stats {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 12px;
    }

    .engagement-card {
        text-align: center;
        padding: 20px 12px;
        background: #f8fafc;
        border-radius: 8px;
        border: 1px solid #e2e8f0;
    }

    .engagement-icon {
        margin-bottom: 12px;
    }

        .engagement-icon.rating {
            color: #f59e0b;
        }

        .engagement-icon.comment {
            color: #3b82f6;
        }

        .engagement-icon.attendance {
            color: #10b981;
        }

    .engagement-value {
        font-size: 24px;
        font-weight: 700;
        color: #1e293b;
        line-height: 1;
        margin-bottom: 4px;
    }

    .engagement-label {
        font-size: 12px;
        color: #64748b;
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }

    /* Loading and Unauthorized */
    .loading-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 60vh;
        gap: 16px;
    }

    .spinner {
        width: 40px;
        height: 40px;
        border: 4px solid #e2e8f0;
        border-top: 4px solid #3b82f6;
        border-radius: 50%;
        animation: spin 1s linear infinite;
    }

    @@keyframes spin {
        0%

    {
        transform: rotate(0deg);
    }

    100% {
        transform: rotate(360deg);
    }

    }

    .unauthorized-container {
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 70vh;
    }

    .unauthorized-card {
        text-align: center;
        padding: 40px;
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        max-width: 400px;
    }

    .unauthorized-icon {
        font-size: 64px;
        margin-bottom: 20px;
    }

    .unauthorized-card h3 {
        margin: 0 0 12px 0;
        font-size: 20px;
        font-weight: 600;
        color: #1e293b;
    }

    .unauthorized-card p {
        margin: 0 0 24px 0;
        color: #64748b;
    }
</style>