@page "/studentsettings"
@using Microsoft.Data.Sqlite
@using Thesis.Models
@using Microsoft.AspNetCore.Components.Forms
@inject AuthStateService AuthStateService
@inject NavigationManager Navigation
@inject IJSRuntime JSRuntime
@inject IConfiguration Configuration
@implements IDisposable

<PageTitle>Thesis - Student Settings</PageTitle>

@if (!isAuthChecked)
{
    <div class="loading-container">
        <div class="spinner"></div>
        <p>Loading Settings...</p>
    </div>
}
else if (!isAuthorized)
{
    <div class="unauthorized-container">
        <div class="unauthorized-card">
            <div class="unauthorized-icon">🚫</div>
            <h3>Access Denied</h3>
            <p>You don't have permission to manage student settings.</p>
            <button class="btn btn-primary" @onclick="RedirectToHome">Return to Home</button>
        </div>
    </div>
}
else
{
    <div class="student-settings">
        <div class="header-bar">
            <button class="back-btn" @onclick="GoBack">← Back to Dashboard</button>
            <h2>Student Settings</h2>
            <div class="info-badge">Student View</div>
        </div>

        @if (isLoading)
        {
            <div class="loading">Loading student settings...</div>
        }
        else if (loadError)
        {
            <div class="error-message">
                <h3>Error Loading Settings</h3>
                <p>Unable to load student settings. Please try again.</p>
                <button class="retry-btn" @onclick="LoadSettings">Retry</button>
            </div>
        }
        else
        {
            <div class="settings-container">
                <!-- Left Navigation -->
                <div class="settings-nav">
                    <div class="nav-section">
                        <h4>Settings</h4>
                        <button class="nav-btn @(activeSection == "profile" ? "active" : "")" @onclick='() => SetActiveSection("profile")'>
                            <span class="nav-icon">👤</span>
                            <span class="nav-text">Profile</span>
                        </button>
                        <button class="nav-btn @(activeSection == "files" ? "active" : "")" @onclick='() => SetActiveSection("files")'>
                            <span class="nav-icon">📁</span>
                            <span class="nav-text">File Upload</span>
                        </button>
                    </div>
                </div>

                <!-- Right Content -->
                <div class="settings-content">
                    <!-- Profile Settings -->
                    @if (activeSection == "profile")
                    {
                        <div class="settings-section">
                            <div class="section-header">
                                <div class="section-title">
                                    <span class="section-icon">👤</span>
                                    <h3>Profile Settings</h3>
                                </div>
                                <p class="section-subtitle">Manage your personal information and preferences</p>
                            </div>

                            <div class="settings-grid">
                                <!-- Profile Picture Upload -->
                                <div class="setting-item">
                                    <label class="setting-label">
                                        <div class="label-header">
                                            <span class="label-title">Profile Picture</span>
                                            <span class="optional-badge">Optional</span>
                                        </div>
                                    </label>

                                    <div class="profile-picture-upload">
                                        <div class="profile-preview-area">
                                            @if (!string.IsNullOrEmpty(profileImageDataUrl))
                                            {
                                                <div class="preview-container">
                                                    <img src="@profileImageDataUrl" alt="Profile Preview"
                                                         class="preview-image" />
                                                    <div class="preview-overlay">
                                                        <button type="button" class="preview-change-btn" @onclick="TriggerFileInput">
                                                            <span class="change-icon">🔄</span>
                                                            Change
                                                        </button>
                                                    </div>
                                                </div>
                                            }
                                            else if (!string.IsNullOrEmpty(studentSettings.ProfilePicture))
                                            {
                                                <div class="preview-container">
                                                    <img src="@studentSettings.ProfilePicture" alt="Profile Preview"
                                                         onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"
                                                         class="preview-image" />
                                                    <div class="preview-fallback" style="display: none;">
                                                        <span class="fallback-icon">📷</span>
                                                        <span>Current image not accessible</span>
                                                    </div>
                                                    <div class="preview-overlay">
                                                        <button type="button" class="preview-change-btn" @onclick="TriggerFileInput">
                                                            <span class="change-icon">🔄</span>
                                                            Change
                                                        </button>
                                                    </div>
                                                </div>
                                            }
                                            else
                                            {
                                                <div class="profile-placeholder" @onclick="TriggerFileInput">
                                                    <span class="placeholder-icon">👤</span>
                                                    <span class="placeholder-text">Upload Profile Picture</span>
                                                    <span class="placeholder-subtext">Click to select an image</span>
                                                </div>
                                            }
                                        </div>

                                        <!-- Hidden file input -->
                                        <InputFile OnChange="OnFileSelected" id="profileUpload"
                                                   accept="image/*" style="display: none;" />

                                        <div class="upload-actions">
                                            <button type="button" class="upload-btn" @onclick="TriggerFileInput">
                                                <span class="upload-icon">📁</span>
                                                Select Image
                                            </button>
                                            @if (!string.IsNullOrEmpty(profileImageDataUrl))
                                            {
                                                <button type="button" class="remove-btn" @onclick="RemoveProfilePicture">
                                                    <span class="remove-icon">🗑️</span>
                                                    Remove
                                                </button>
                                            }
                                        </div>

                                        @if (!string.IsNullOrEmpty(uploadError))
                                        {
                                            <div class="upload-error">
                                                <span class="error-icon">❌</span>
                                                <span>@uploadError</span>
                                            </div>
                                        }

                                        <div class="upload-info">
                                            <div class="info-row">
                                                <span class="info-icon">📏</span>
                                                <span>Recommended: 500x500 pixels</span>
                                            </div>
                                            <div class="info-row">
                                                <span class="info-icon">💾</span>
                                                <span>Max size: 5MB</span>
                                            </div>
                                            <div class="info-row">
                                                <span class="info-icon">🖼️</span>
                                                <span>Formats: JPG, PNG, GIF, WebP</span>
                                            </div>
                                        </div>

                                        @if (selectedFile != null)
                                        {
                                            <div class="file-info">
                                                <div class="file-name">
                                                    <span class="file-icon">📄</span>
                                                    <span>@selectedFile.Name</span>
                                                </div>
                                                <div class="file-details">
                                                    <span>Size: @((selectedFile.Size / 1024).ToString("0.0")) KB</span>
                                                    <span>Type: @selectedFile.ContentType</span>
                                                </div>
                                                <button type="button" class="file-remove-btn" @onclick="ClearSelectedFile">
                                                    <span class="remove-icon">✕</span>
                                                </button>
                                            </div>
                                        }
                                    </div>
                                </div>

                                <!-- Bio -->
                                <div class="setting-item">
                                    <label class="setting-label">
                                        <div class="label-header">
                                            <span class="label-title">Bio</span>
                                            <span class="optional-badge">Optional</span>
                                            <span class="char-count">@(studentSettings.Bio?.Length ?? 0)/500</span>
                                        </div>
                                        <textarea @bind="studentSettings.Bio" @oninput="UpdateBioCharCount"
                                                  class="setting-textarea" rows="4"
                                                  placeholder="Tell us about yourself, your interests, and academic goals..."></textarea>
                                    </label>
                                    <small class="setting-description">Share a brief introduction about yourself</small>
                                </div>

                                <!-- Contact Info -->
                                <div class="settings-row">
                                    <div class="setting-item">
                                        <label class="setting-label">
                                            <div class="label-header">
                                                <span class="label-title">Phone Number</span>
                                                <span class="optional-badge">Optional</span>
                                            </div>
                                            <input type="tel" @bind="studentSettings.PhoneNumber" class="setting-input"
                                                   placeholder="+1 (123) 456-7890" />
                                        </label>
                                        <small class="setting-description">Your contact phone number</small>
                                    </div>

                                    <div class="setting-item">
                                        <label class="setting-label">
                                            <div class="label-title">Time Zone</div>
                                            <div class="select-wrapper">
                                                <select @bind="studentSettings.TimeZone" class="setting-select">
                                                    <option value="UTC">UTC (Coordinated Universal Time)</option>
                                                    <option value="EST">EST (Eastern Standard Time)</option>
                                                    <option value="CST">CST (Central Standard Time)</option>
                                                    <option value="MST">MST (Mountain Standard Time)</option>
                                                    <option value="PST">PST (Pacific Standard Time)</option>
                                                    <option value="GMT">GMT (Greenwich Mean Time)</option>
                                                    <option value="CET">CET (Central European Time)</option>
                                                    <option value="IST">IST (Indian Standard Time)</option>
                                                    <option value="JST">JST (Japan Standard Time)</option>
                                                    <option value="AEST">AEST (Australian Eastern Time)</option>
                                                </select>
                                                <span class="select-arrow">▼</span>
                                            </div>
                                        </label>
                                        <small class="setting-description">Your local time zone for scheduling</small>
                                    </div>
                                </div>

                                <!-- Address -->
                                <div class="setting-item">
                                    <label class="setting-label">
                                        <div class="label-header">
                                            <span class="label-title">Address</span>
                                            <span class="optional-badge">Optional</span>
                                        </div>
                                        <textarea @bind="studentSettings.Address" class="setting-textarea" rows="3"
                                                  placeholder="Your current residential address..."></textarea>
                                    </label>
                                    <small class="setting-description">Your current residential address (not shared publicly)</small>
                                </div>
                            </div>
                        </div>
                    }

                    <!-- File Upload Settings -->
                    @if (activeSection == "files")
                    {
                        <div class="settings-section">
                            <div class="section-header">
                                <div class="section-title">
                                    <span class="section-icon">📁</span>
                                    <h3>File Upload Settings</h3>
                                </div>
                                <p class="section-subtitle">Configure file upload preferences for assignments and submissions</p>
                            </div>

                            <div class="settings-grid">
                                <div class="setting-item">
                                    <label class="setting-label">
                                        <div class="label-header">
                                            <span class="label-title">Maximum File Size (MB)</span>
                                            <span class="value-badge">@studentSettings.MaxFileSizeMB MB</span>
                                        </div>
                                        <div class="slider-container">
                                            <input type="range" min="1" max="100" step="1" @bind="studentSettings.MaxFileSizeMB"
                                                   @oninput="UpdateMaxFileSize" class="setting-slider" />
                                            <div class="slider-labels">
                                                <span>1 MB</span>
                                                <span>50 MB</span>
                                                <span>100 MB</span>
                                            </div>
                                        </div>
                                    </label>
                                    <small class="setting-description">Maximum file size for uploads (1-100 MB)</small>
                                </div>

                                <div class="setting-item">
                                    <label class="setting-label">
                                        <div class="label-header">
                                            <span class="label-title">Allowed File Types</span>
                                            <span class="types-count">@GetFileTypesCount() types</span>
                                        </div>
                                        <input type="text" @bind="studentSettings.AllowedFileTypes" class="setting-input"
                                               placeholder="jpg,jpeg,png,gif,pdf,docx" />
                                    </label>
                                    <small class="setting-description">Comma-separated file extensions (e.g., jpg,png,pdf,docx)</small>

                                    <div class="file-types-info">
                                        <div class="info-header">
                                            <span class="info-icon">💡</span>
                                            <h4>Common file types:</h4>
                                        </div>
                                        <div class="file-categories">
                                            <div class="category">
                                                <span class="category-title">📸 Images</span>
                                                <div class="file-tags">
                                                    <span class="file-tag">jpg</span>
                                                    <span class="file-tag">jpeg</span>
                                                    <span class="file-tag">png</span>
                                                    <span class="file-tag">gif</span>
                                                    <span class="file-tag">webp</span>
                                                </div>
                                            </div>
                                            <div class="category">
                                                <span class="category-title">📄 Documents</span>
                                                <div class="file-tags">
                                                    <span class="file-tag">pdf</span>
                                                    <span class="file-tag">doc</span>
                                                    <span class="file-tag">docx</span>
                                                    <span class="file-tag">txt</span>
                                                </div>
                                            </div>
                                            <div class="category">
                                                <span class="category-title">📊 Presentations</span>
                                                <div class="file-tags">
                                                    <span class="file-tag">ppt</span>
                                                    <span class="file-tag">pptx</span>
                                                </div>
                                            </div>
                                            <div class="category">
                                                <span class="category-title">📈 Spreadsheets</span>
                                                <div class="file-tags">
                                                    <span class="file-tag">xls</span>
                                                    <span class="file-tag">xlsx</span>
                                                    <span class="file-tag">csv</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    }

                    <!-- Action Buttons -->
                    <div class="settings-actions">
                        <div class="actions-left">
                            <span class="last-saved">
                                @if (settingsLoaded && studentSettings.Id > 0)
                                {
                                    <span class="saved-icon">🕒</span>
                                    <span>Last saved: @studentSettings.UpdatedAt.ToString("MMM dd, yyyy HH:mm")</span>
                                }
                                else
                                {
                                    <span class="saved-icon">⚠️</span>
                                    <span>Not saved yet</span>
                                }
                            </span>
                        </div>
                        <div class="actions-right">
                            <button type="button" class="cancel-btn" @onclick="GoBack">
                                <span class="btn-icon">❌</span>
                                <span class="btn-text">Cancel</span>
                            </button>
                            <button type="button" class="reset-btn" @onclick="ResetToDefaults">
                                <span class="btn-icon">🔄</span>
                                <span class="btn-text">Reset Defaults</span>
                            </button>
                            <button type="button" class="save-btn" @onclick="SaveSettingsWithImage" disabled="@isSaving">
                                @if (isSaving)
                                {
                                    <span class="btn-icon">
                                        <div class="save-spinner"></div>
                                    </span>
                                    <span class="btn-text">Saving...</span>
                                }
                                else
                                {
                                    <span class="btn-icon">💾</span>
                                    <span class="btn-text">Save Settings</span>
                                }
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        }
    </div>
}

@code {
    private bool isAuthorized = false;
    private bool isAuthChecked = false;
    private bool isLoading = false;
    private bool isSaving = false;
    private bool loadError = false;

    private string activeSection = "profile";
    private Thesis.Models.StudentSettings studentSettings = new();
    private bool settingsLoaded = false;

    // File upload variables
    private IBrowserFile? selectedFile = null;
    private string profileImageDataUrl = string.Empty;
    private string uploadError = string.Empty;
    private DotNetObjectReference<StudentSettings>? dotNetHelper;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            await AuthStateService.InitializeAsync();
            var user = AuthStateService.CurrentUser;

            isAuthorized = user != null && (user.Role == "Student" || user.Role == "Admin");
            isAuthChecked = true;

            if (isAuthorized)
            {
                await LoadSettings();
            }
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error initializing: {ex.Message}");
            isAuthChecked = true;
        }
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            dotNetHelper = DotNetObjectReference.Create(this);
        }
    }

    private void UpdateMaxFileSize(ChangeEventArgs e)
    {
        if (int.TryParse(e.Value?.ToString(), out int value))
        {
            studentSettings.MaxFileSizeMB = value;
            StateHasChanged();
        }
    }

    private void UpdateBioCharCount(ChangeEventArgs e)
    {
        StateHasChanged();
    }

    private int GetFileTypesCount()
    {
        if (string.IsNullOrEmpty(studentSettings.AllowedFileTypes))
            return 0;

        return studentSettings.AllowedFileTypes
            .Split(',', StringSplitOptions.RemoveEmptyEntries)
            .Select(x => x.Trim())
            .Count();
    }

    private async Task LoadSettings()
    {
        isLoading = true;
        loadError = false;
        StateHasChanged();

        try
        {
            var studentId = await GetCurrentStudentId();
            if (studentId > 0)
            {
                studentSettings = await GetStudentSettingsFromDatabase(studentId);

                if (studentSettings == null)
                {
                    studentSettings = new Thesis.Models.StudentSettings
                    {
                        StudentId = studentId
                    };
                }
                else
                {
                    settingsLoaded = true;
                }
            }
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error loading settings: {ex.Message}");
            loadError = true;
            await JSRuntime.InvokeVoidAsync("alert", $"Error loading settings: {ex.Message}");
        }
        finally
        {
            isLoading = false;
            StateHasChanged();
        }
    }

    private async Task<Thesis.Models.StudentSettings> GetStudentSettingsFromDatabase(int studentId)
    {
        var connectionString = Configuration.GetConnectionString("DefaultConnection");

        using var connection = new SqliteConnection(connectionString);
        await connection.OpenAsync();

        var command = connection.CreateCommand();
        command.CommandText = @"
            SELECT Id, StudentId, ProfilePicture, Bio, PhoneNumber, Address,
                   TimeZone, MaxFileSizeMB, AllowedFileTypes, CreatedAt, UpdatedAt
            FROM StudentSettings
            WHERE StudentId = @studentId";

        command.Parameters.AddWithValue("@studentId", studentId);

        using var reader = await command.ExecuteReaderAsync();

        if (await reader.ReadAsync())
        {
            return new Thesis.Models.StudentSettings
            {
                Id = reader.GetInt32(0),
                StudentId = reader.GetInt32(1),
                ProfilePicture = !reader.IsDBNull(2) ? reader.GetString(2) : null,
                Bio = !reader.IsDBNull(3) ? reader.GetString(3) : null,
                PhoneNumber = !reader.IsDBNull(4) ? reader.GetString(4) : null,
                Address = !reader.IsDBNull(5) ? reader.GetString(5) : null,
                TimeZone = reader.GetString(6),
                MaxFileSizeMB = reader.GetInt32(7),
                AllowedFileTypes = reader.GetString(8),
                CreatedAt = DateTime.Parse(reader.GetString(9)),
                UpdatedAt = DateTime.Parse(reader.GetString(10))
            };
        }

        return null;
    }

    private async Task TriggerFileInput()
    {
        await JSRuntime.InvokeVoidAsync("triggerFileInput", "profileUpload");
    }

    private async Task OnFileSelected(InputFileChangeEventArgs e)
    {
        try
        {
            uploadError = string.Empty;
            selectedFile = e.File;

            // Validate file size (max 5MB)
            const long maxFileSize = 5 * 1024 * 1024; // 5MB
            if (selectedFile.Size > maxFileSize)
            {
                uploadError = $"File size exceeds 5MB limit. Selected file: {(selectedFile.Size / 1024 / 1024):0.00} MB";
                selectedFile = null;
                StateHasChanged();
                return;
            }

            // Validate file type
            var allowedTypes = new[] { "image/jpeg", "image/png", "image/gif", "image/webp" };
            if (!allowedTypes.Contains(selectedFile.ContentType))
            {
                uploadError = $"Invalid file type. Allowed: JPG, PNG, GIF, WebP. Selected: {selectedFile.ContentType}";
                selectedFile = null;
                StateHasChanged();
                return;
            }

            // Read and display the image
            var resizedImage = await selectedFile.RequestImageFileAsync(selectedFile.ContentType, 500, 500);
            var buffer = new byte[resizedImage.Size];
            await resizedImage.OpenReadStream(maxFileSize).ReadAsync(buffer);
            profileImageDataUrl = $"data:{selectedFile.ContentType};base64,{Convert.ToBase64String(buffer)}";

            StateHasChanged();
        }
        catch (Exception ex)
        {
            uploadError = $"Error processing image: {ex.Message}";
            selectedFile = null;
            StateHasChanged();
        }
    }

    private void ClearSelectedFile()
    {
        selectedFile = null;
        profileImageDataUrl = string.Empty;
        uploadError = string.Empty;
        StateHasChanged();
    }

    private void RemoveProfilePicture()
    {
        selectedFile = null;
        profileImageDataUrl = string.Empty;
        studentSettings.ProfilePicture = null;
        uploadError = string.Empty;
        StateHasChanged();
    }

    private void SetActiveSection(string section)
    {
        activeSection = section;
        StateHasChanged();
    }

    private async Task SaveSettingsWithImage()
    {
        isSaving = true;
        StateHasChanged();

        try
        {
            // If a new image was selected, upload it
            if (selectedFile != null && !string.IsNullOrEmpty(profileImageDataUrl))
            {
                studentSettings.ProfilePicture = profileImageDataUrl;
            }

            studentSettings.UpdatedAt = DateTime.Now;
            var studentId = await GetCurrentStudentId();

            if (studentSettings.StudentId <= 0)
            {
                studentSettings.StudentId = studentId;
            }

            await SaveStudentSettingsToDatabase(studentSettings);
            settingsLoaded = true;

            await JSRuntime.InvokeVoidAsync("alert", "Settings saved successfully!");
        }
        catch (Exception ex)
        {
            await JSRuntime.InvokeVoidAsync("alert", $"Error saving settings: {ex.Message}");
        }
        finally
        {
            isSaving = false;
            StateHasChanged();
        }
    }

    private async Task SaveStudentSettingsToDatabase(Thesis.Models.StudentSettings settings)
    {
        var connectionString = Configuration.GetConnectionString("DefaultConnection");

        using var connection = new SqliteConnection(connectionString);
        await connection.OpenAsync();

        var checkCommand = connection.CreateCommand();
        checkCommand.CommandText = "SELECT COUNT(*) FROM StudentSettings WHERE StudentId = @studentId";
        checkCommand.Parameters.AddWithValue("@studentId", settings.StudentId);

        var exists = Convert.ToInt32(await checkCommand.ExecuteScalarAsync()) > 0;

        if (exists)
        {
            var updateCommand = connection.CreateCommand();
            updateCommand.CommandText = @"
                UPDATE StudentSettings
                SET ProfilePicture = @profilePicture,
                    Bio = @bio,
                    PhoneNumber = @phoneNumber,
                    Address = @address,
                    TimeZone = @timeZone,
                    MaxFileSizeMB = @maxFileSizeMB,
                    AllowedFileTypes = @allowedFileTypes,
                    UpdatedAt = @updatedAt
                WHERE StudentId = @studentId";

            updateCommand.Parameters.AddWithValue("@profilePicture", (object)settings.ProfilePicture ?? DBNull.Value);
            updateCommand.Parameters.AddWithValue("@bio", (object)settings.Bio ?? DBNull.Value);
            updateCommand.Parameters.AddWithValue("@phoneNumber", (object)settings.PhoneNumber ?? DBNull.Value);
            updateCommand.Parameters.AddWithValue("@address", (object)settings.Address ?? DBNull.Value);
            updateCommand.Parameters.AddWithValue("@timeZone", settings.TimeZone);
            updateCommand.Parameters.AddWithValue("@maxFileSizeMB", settings.MaxFileSizeMB);
            updateCommand.Parameters.AddWithValue("@allowedFileTypes", settings.AllowedFileTypes);
            updateCommand.Parameters.AddWithValue("@updatedAt", settings.UpdatedAt.ToString("yyyy-MM-dd HH:mm:ss"));
            updateCommand.Parameters.AddWithValue("@studentId", settings.StudentId);

            await updateCommand.ExecuteNonQueryAsync();
        }
        else
        {
            var insertCommand = connection.CreateCommand();
            insertCommand.CommandText = @"
                INSERT INTO StudentSettings
                (StudentId, ProfilePicture, Bio, PhoneNumber, Address, TimeZone,
                 MaxFileSizeMB, AllowedFileTypes, CreatedAt, UpdatedAt)
                VALUES
                (@studentId, @profilePicture, @bio, @phoneNumber, @address, @timeZone,
                 @maxFileSizeMB, @allowedFileTypes, @createdAt, @updatedAt)";

            insertCommand.Parameters.AddWithValue("@studentId", settings.StudentId);
            insertCommand.Parameters.AddWithValue("@profilePicture", (object)settings.ProfilePicture ?? DBNull.Value);
            insertCommand.Parameters.AddWithValue("@bio", (object)settings.Bio ?? DBNull.Value);
            insertCommand.Parameters.AddWithValue("@phoneNumber", (object)settings.PhoneNumber ?? DBNull.Value);
            insertCommand.Parameters.AddWithValue("@address", (object)settings.Address ?? DBNull.Value);
            insertCommand.Parameters.AddWithValue("@timeZone", settings.TimeZone);
            insertCommand.Parameters.AddWithValue("@maxFileSizeMB", settings.MaxFileSizeMB);
            insertCommand.Parameters.AddWithValue("@allowedFileTypes", settings.AllowedFileTypes);
            insertCommand.Parameters.AddWithValue("@createdAt", settings.CreatedAt.ToString("yyyy-MM-dd HH:mm:ss"));
            insertCommand.Parameters.AddWithValue("@updatedAt", settings.UpdatedAt.ToString("yyyy-MM-dd HH:mm:ss"));

            await insertCommand.ExecuteNonQueryAsync();
        }
    }

    private async Task ResetToDefaults()
    {
        var confirmed = await JSRuntime.InvokeAsync<bool>("confirm",
            "Are you sure you want to reset all settings to default values?");

        if (!confirmed) return;

        try
        {
            var studentId = await GetCurrentStudentId();
            studentSettings = new Thesis.Models.StudentSettings
            {
                StudentId = studentId
            };
            selectedFile = null;
            profileImageDataUrl = string.Empty;
            uploadError = string.Empty;
            StateHasChanged();
        }
        catch (Exception ex)
        {
            await JSRuntime.InvokeVoidAsync("alert", $"Error resetting settings: {ex.Message}");
        }
    }

    private async Task<int> GetCurrentStudentId()
    {
        var user = AuthStateService.CurrentUser;
        return user?.Id ?? 0;
    }

    private void GoBack() => Navigation.NavigateTo("/studenthome");
    private void RedirectToHome() => Navigation.NavigateTo("/");

    public void Dispose()
    {
        dotNetHelper?.Dispose();
    }
}
<style>
    /* Base Styles */
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    /* Loading and Auth States */
    .loading-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    .spinner {
        width: 60px;
        height: 60px;
        border: 5px solid rgba(255, 255, 255, 0.2);
        border-top-color: white;
        border-radius: 50%;
        animation: spin 1s ease-in-out infinite;
    }

    @@keyframes spin {
        to {
            transform: rotate(360deg);
        }
    }

    .loading-container p {
        margin-top: 25px;
        color: white;
        font-size: 1.2rem;
        font-weight: 600;
        letter-spacing: 0.5px;
    }

    .unauthorized-container {
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        padding: 20px;
    }

    .unauthorized-card {
        background: white;
        padding: 60px 50px;
        border-radius: 24px;
        text-align: center;
        box-shadow: 0 25px 80px rgba(0, 0, 0, 0.25);
        max-width: 450px;
        animation: slideUp 0.4s ease-out;
    }

    @@keyframes slideUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .unauthorized-icon {
        font-size: 5rem;
        margin-bottom: 25px;
        animation: bounce 2s ease-in-out infinite;
    }

    @@keyframes bounce {
        0%, 100% {
            transform: translateY(0);
        }

        50% {
            transform: translateY(-10px);
        }
    }

    .unauthorized-card h3 {
        font-size: 2rem;
        color: #2d3748;
        margin-bottom: 15px;
        font-weight: 700;
    }

    .unauthorized-card p {
        color: #718096;
        margin-bottom: 35px;
        font-size: 1.1rem;
        line-height: 1.6;
    }

    .btn-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 12px;
        cursor: pointer;
        font-size: 0.95rem;
        font-weight: 600;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

    /* Main Container */
    .student-settings {
        min-height: 100vh;
        background: linear-gradient(135deg, #f5f7fa 0%, #e4e8f0 100%);
        padding: 30px;
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }

    /* Header Bar */
    .header-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
        padding: 25px 35px;
        background: white;
        border-radius: 20px;
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.08);
        flex-wrap: wrap;
        gap: 20px;
        border: 1px solid rgba(0, 0, 0, 0.05);
    }

        .header-bar h2 {
            color: #2d3748;
            font-size: 2.2rem;
            font-weight: 800;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.5px;
        }

    .info-badge {
        padding: 10px 20px;
        background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
        color: #667eea;
        border-radius: 15px;
        font-weight: 700;
        font-size: 0.95rem;
        border: 2px solid rgba(102, 126, 234, 0.2);
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .back-btn {
        background: white;
        color: #667eea;
        border: 2px solid rgba(102, 126, 234, 0.3);
        padding: 12px 24px;
        border-radius: 12px;
        cursor: pointer;
        font-size: 1rem;
        font-weight: 600;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 8px;
    }

        .back-btn:hover {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: transparent;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.3);
        }

    /* Loading State */
    .loading {
        text-align: center;
        padding: 60px 40px;
        background: white;
        border-radius: 20px;
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.08);
        color: #667eea;
        font-size: 1.1rem;
        font-weight: 600;
        border: 1px solid rgba(0, 0, 0, 0.05);
    }

    /* Error Message */
    .error-message {
        text-align: center;
        padding: 60px 40px;
        background: white;
        border-radius: 20px;
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.08);
        border: 1px solid rgba(0, 0, 0, 0.05);
    }

        .error-message h3 {
            color: #e53e3e;
            margin-bottom: 15px;
            font-size: 1.8rem;
        }

        .error-message p {
            color: #718096;
            margin-bottom: 25px;
            font-size: 1.1rem;
        }

    .retry-btn {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 12px 28px;
        border-radius: 12px;
        cursor: pointer;
        font-size: 1rem;
        font-weight: 600;
        transition: all 0.3s ease;
    }

        .retry-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

    /* Settings Container */
    .settings-container {
        display: grid;
        grid-template-columns: 300px 1fr;
        gap: 30px;
        animation: fadeIn 0.5s ease-out;
    }

    @@keyframes fadeIn {
        from {
            opacity: 0;
        }

        to {
            opacity: 1;
        }
    }

    /* Settings Navigation */
    .settings-nav {
        background: white;
        border-radius: 20px;
        padding: 25px;
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.08);
        height: fit-content;
        position: sticky;
        top: 30px;
        border: 1px solid rgba(0, 0, 0, 0.05);
    }

    .nav-section {
        margin-bottom: 30px;
    }

        .nav-section:last-child {
            margin-bottom: 0;
        }

        .nav-section h4 {
            font-size: 0.85rem;
            color: #718096;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 700;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid #e2e8f0;
        }

    .nav-btn {
        width: 100%;
        padding: 16px 20px;
        background: transparent;
        border: none;
        border-radius: 15px;
        cursor: pointer;
        font-size: 1rem;
        font-weight: 500;
        color: #4a5568;
        text-align: left;
        transition: all 0.3s ease;
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        gap: 12px;
        border: 2px solid transparent;
    }

        .nav-btn:hover {
            background: rgba(102, 126, 234, 0.08);
            color: #667eea;
            transform: translateX(5px);
            border-color: rgba(102, 126, 234, 0.2);
        }

        .nav-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            border-color: transparent;
            transform: translateX(0);
        }

    .nav-icon {
        font-size: 1.2rem;
    }

    .nav-text {
        flex: 1;
    }

    /* Settings Content */
    .settings-content {
        background: white;
        border-radius: 20px;
        padding: 40px;
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.08);
        animation: slideInRight 0.5s ease-out;
        border: 1px solid rgba(0, 0, 0, 0.05);
    }

    @@keyframes slideInRight {
        from {
            opacity: 0;
            transform: translateX(30px);
        }

        to {
            opacity: 1;
            transform: translateX(0);
        }
    }

    /* Profile Picture Upload */
    .profile-picture-upload {
        margin-top: 10px;
    }

    .profile-preview-area {
        margin-bottom: 20px;
    }

    .preview-container {
        position: relative;
        width: 150px;
        height: 150px;
        border-radius: 20px;
        overflow: hidden;
        border: 3px solid #e2e8f0;
        cursor: pointer;
    }

    .preview-image {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.3s ease;
    }

    .preview-container:hover .preview-image {
        transform: scale(1.05);
    }

    .preview-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.6);
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    .preview-container:hover .preview-overlay {
        opacity: 1;
    }

    .preview-change-btn {
        background: rgba(255, 255, 255, 0.9);
        color: #2d3748;
        border: none;
        padding: 8px 16px;
        border-radius: 8px;
        font-size: 0.9rem;
        font-weight: 600;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 6px;
        transition: all 0.3s ease;
    }

        .preview-change-btn:hover {
            background: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

    .change-icon {
        font-size: 1rem;
    }

    .profile-placeholder {
        width: 150px;
        height: 150px;
        border-radius: 20px;
        border: 3px dashed #cbd5e1;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 10px;
        cursor: pointer;
        transition: all 0.3s ease;
        background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);
    }

        .profile-placeholder:hover {
            border-color: #667eea;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
            transform: translateY(-2px);
        }

    .placeholder-icon {
        font-size: 2.5rem;
        color: #667eea;
    }

    .placeholder-text {
        font-weight: 600;
        color: #2d3748;
        font-size: 0.95rem;
    }

    .placeholder-subtext {
        color: #718096;
        font-size: 0.8rem;
    }

    /* Upload Actions */
    .upload-actions {
        display: flex;
        gap: 12px;
        margin-bottom: 20px;
    }

    .upload-btn, .remove-btn {
        padding: 12px 20px;
        border-radius: 10px;
        font-size: 0.95rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        border: 2px solid transparent;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .upload-btn {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
    }

        .upload-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.3);
        }

    .remove-btn {
        background: white;
        color: #e53e3e;
        border-color: #e53e3e;
    }

        .remove-btn:hover {
            background: #e53e3e;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(229, 62, 62, 0.3);
        }

    .upload-icon, .remove-icon {
        font-size: 1.1rem;
    }

    /* Upload Error */
    .upload-error {
        padding: 12px 16px;
        background: rgba(229, 62, 62, 0.1);
        border: 1px solid rgba(229, 62, 62, 0.2);
        border-radius: 10px;
        color: #e53e3e;
        font-size: 0.9rem;
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 20px;
    }

    .error-icon {
        font-size: 1.2rem;
    }

    /* Upload Info */
    .upload-info {
        background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);
        padding: 16px 20px;
        border-radius: 10px;
        border: 1px solid rgba(102, 126, 234, 0.1);
        margin-bottom: 20px;
    }

    .info-row {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 8px;
        color: #4a5568;
        font-size: 0.9rem;
    }

        .info-row:last-child {
            margin-bottom: 0;
        }

    .info-icon {
        font-size: 1rem;
        color: #667eea;
    }

    /* File Info */
    .file-info {
        background: white;
        border: 2px solid #e2e8f0;
        border-radius: 10px;
        padding: 16px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 15px;
        margin-top: 15px;
    }

    .file-name {
        display: flex;
        align-items: center;
        gap: 10px;
        font-weight: 600;
        color: #2d3748;
        flex: 1;
    }

    .file-icon {
        font-size: 1.2rem;
        color: #667eea;
    }

    .file-details {
        display: flex;
        flex-direction: column;
        gap: 4px;
        color: #718096;
        font-size: 0.85rem;
    }

    .file-remove-btn {
        background: none;
        border: none;
        color: #718096;
        cursor: pointer;
        font-size: 1.2rem;
        padding: 4px 8px;
        border-radius: 6px;
        transition: all 0.2s ease;
    }

        .file-remove-btn:hover {
            background: rgba(229, 62, 62, 0.1);
            color: #e53e3e;
        }

    /* Section Header */
    .section-header {
        margin-bottom: 40px;
    }

    .section-title {
        display: flex;
        align-items: center;
        gap: 15px;
        margin-bottom: 10px;
    }

    .section-icon {
        font-size: 2rem;
    }

    .section-title h3 {
        font-size: 1.8rem;
        color: #2d3748;
        font-weight: 700;
    }

    .section-subtitle {
        color: #718096;
        font-size: 1.1rem;
        line-height: 1.6;
        padding-left: 55px;
    }

    /* Settings Grid */
    .settings-grid {
        display: flex;
        flex-direction: column;
        gap: 35px;
    }

    .settings-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
    }

    /* Setting Item */
    .setting-item {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    .setting-label {
        display: flex;
        flex-direction: column;
        gap: 12px;
    }

    .label-header {
        display: flex;
        align-items: center;
        gap: 10px;
        flex-wrap: wrap;
    }

    .label-title {
        font-weight: 700;
        color: #2d3748;
        font-size: 1.1rem;
    }

    .optional-badge {
        background: rgba(245, 158, 11, 0.1);
        color: #f59e0b;
        padding: 4px 10px;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 600;
    }

    .value-badge {
        background: rgba(102, 126, 234, 0.1);
        color: #667eea;
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 0.9rem;
        font-weight: 600;
        margin-left: auto;
    }

    .types-count {
        background: rgba(16, 185, 129, 0.1);
        color: #10b981;
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 0.9rem;
        font-weight: 600;
        margin-left: auto;
    }

    .char-count {
        margin-left: auto;
        color: #718096;
        font-size: 0.9rem;
        font-weight: 500;
    }

    /* Input Styles */
    .setting-input,
    .setting-textarea,
    .setting-select {
        width: 100%;
        padding: 16px 20px;
        border: 2px solid #e2e8f0;
        border-radius: 12px;
        font-size: 1rem;
        transition: all 0.3s ease;
        background: white;
        color: #2d3748;
        font-family: inherit;
        line-height: 1.5;
    }

        .setting-input:focus,
        .setting-textarea:focus,
        .setting-select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
        }

    .setting-textarea {
        resize: vertical;
        min-height: 120px;
        line-height: 1.6;
    }

    .setting-input[type="number"] {
        -moz-appearance: textfield;
    }

        .setting-input[type="number"]::-webkit-inner-spin-button,
        .setting-input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

    /* Select Wrapper */
    .select-wrapper {
        position: relative;
    }

    .select-arrow {
        position: absolute;
        right: 20px;
        top: 50%;
        transform: translateY(-50%);
        color: #718096;
        pointer-events: none;
    }

    /* Slider */
    .slider-container {
        margin-top: 10px;
    }

    .setting-slider {
        width: 100%;
        height: 8px;
        -webkit-appearance: none;
        appearance: none;
        background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
        border-radius: 4px;
        outline: none;
    }

        .setting-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: white;
            border: 3px solid #667eea;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }

            .setting-slider::-webkit-slider-thumb:hover {
                transform: scale(1.1);
                box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
            }

    .slider-labels {
        display: flex;
        justify-content: space-between;
        margin-top: 10px;
        color: #718096;
        font-size: 0.9rem;
    }

    /* File Types Info */
    .file-types-info {
        margin-top: 25px;
        padding: 25px;
        background: linear-gradient(135deg, rgba(245, 158, 11, 0.05) 0%, rgba(217, 119, 6, 0.05) 100%);
        border-radius: 15px;
        border: 1px solid rgba(245, 158, 11, 0.2);
    }

    .info-header {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 20px;
    }

    .info-icon {
        font-size: 1.5rem;
    }

    .info-header h4 {
        color: #2d3748;
        font-size: 1.1rem;
        font-weight: 600;
    }

    .file-categories {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
    }

    .category {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    .category-title {
        font-weight: 600;
        color: #2d3748;
        font-size: 1rem;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .file-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
    }

    .file-tag {
        background: white;
        color: #4a5568;
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 500;
        border: 1px solid #e2e8f0;
        transition: all 0.2s ease;
    }

        .file-tag:hover {
            background: #667eea;
            color: white;
            border-color: #667eea;
            transform: translateY(-2px);
        }

    /* Settings Actions */
    .settings-actions {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding-top: 40px;
        margin-top: 40px;
        border-top: 2px solid #e2e8f0;
        flex-wrap: wrap;
        gap: 20px;
    }

    .actions-left {
        flex: 1;
    }

    .last-saved {
        display: flex;
        align-items: center;
        gap: 10px;
        color: #718096;
        font-size: 0.95rem;
    }

    .saved-icon {
        font-size: 1.2rem;
    }

    .actions-right {
        display: flex;
        gap: 15px;
    }

    .save-btn,
    .reset-btn,
    .cancel-btn {
        padding: 16px 32px;
        border: none;
        border-radius: 12px;
        cursor: pointer;
        font-size: 1rem;
        font-weight: 600;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        gap: 10px;
        min-width: 140px;
        justify-content: center;
    }

    .save-btn {
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        color: white;
        box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
    }

        .save-btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.4);
        }

        .save-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

    .save-spinner {
        width: 20px;
        height: 20px;
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-top-color: white;
        border-radius: 50%;
        animation: spin 1s ease-in-out infinite;
    }

    .reset-btn {
        background: white;
        color: #f59e0b;
        border: 2px solid rgba(245, 158, 11, 0.3);
    }

        .reset-btn:hover {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
            border-color: transparent;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(245, 158, 11, 0.3);
        }

    .cancel-btn {
        background: white;
        color: #4a5568;
        border: 2px solid #e2e8f0;
    }

        .cancel-btn:hover {
            background: #f8f9fa;
            border-color: #cbd5e1;
            transform: translateY(-2px);
        }

    .btn-icon {
        font-size: 1.2rem;
    }

    .btn-text {
        font-size: 1rem;
    }

    /* Setting Description */
    .setting-description {
        color: #718096;
        font-size: 0.9rem;
        font-weight: 400;
        line-height: 1.5;
        margin-top: 5px;
    }

    /* Scrollbar Styling */
    ::-webkit-scrollbar {
        width: 10px;
    }

    ::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 10px;
    }

    ::-webkit-scrollbar-thumb {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 10px;
    }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #5568d3 0%, #653a8e 100%);
        }

    /* Responsive Design */
    @@media (max-width: 1200px) {
        .settings-container {
            grid-template-columns: 1fr;
        }

        .settings-nav {
            position: static;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .nav-section {
            margin-bottom: 0;
        }

        .nav-btn {
            text-align: center;
            justify-content: center;
            padding: 14px;
        }

            .nav-btn:hover {
                transform: translateY(-2px) !important;
            }
    }

    @@media (max-width: 768px) {
        .student-settings {
            padding: 20px;
        }

        .header-bar {
            flex-direction: column;
            align-items: flex-start;
            padding: 20px;
        }

            .header-bar h2 {
                font-size: 1.8rem;
            }

        .settings-content {
            padding: 25px;
        }

        .settings-row {
            grid-template-columns: 1fr;
            gap: 25px;
        }

        .section-title h3 {
            font-size: 1.5rem;
        }

        .section-subtitle {
            padding-left: 0;
        }

        .settings-actions {
            flex-direction: column;
            align-items: stretch;
        }

        .actions-right {
            flex-direction: column;
            width: 100%;
        }

        .save-btn,
        .reset-btn,
        .cancel-btn {
            width: 100%;
            justify-content: center;
        }

        .file-categories {
            grid-template-columns: 1fr;
        }

        .upload-actions {
            flex-direction: column;
        }

        .upload-btn, .remove-btn {
            width: 100%;
            justify-content: center;
        }
    }

    @@media (max-width: 480px) {
        .settings-nav {
            grid-template-columns: 1fr;
        }

        .setting-label {
            font-size: 0.95rem;
        }

        .setting-input,
        .setting-textarea,
        .setting-select {
            font-size: 0.95rem;
            padding: 14px 16px;
        }

        .save-btn,
        .reset-btn,
        .cancel-btn {
            padding: 14px 20px;
            min-width: unset;
        }

        .preview-container,
        .profile-placeholder {
            width: 120px;
            height: 120px;
        }
    }
</style>